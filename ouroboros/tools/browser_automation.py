from playwright.sync_api import Page, BrowserContext\nimport time\nimport random\n\ndef spoof_plugins(page: Page):\n    \"\"\"\n    Имитирует реальные плагины браузера для обхода headless-детекции.\n    Пример использования:\n    >> spoof_plugins(page)\n    \"\"\"\n    page.evaluate('''()\n    => {\n        const fakePlugins = [\n            { name: 'WidevineCdm', description: 'Widevine Content Decryption Module' },\n            { name: 'Shockwave Flash', description: 'Adobe Flash Player' },\n            { name: 'Chrome PDF Viewer', description: 'Portable Document Format' }\n        ];\n        Object.defineProperty(navigator, 'plugins', {\n            get: () => fakePlugins\n        });\n    }''')\n\ndef emulate_human_behavior(page: Page):\n    \"\"\"\n    Добавляет человеческие паттерны взаимодействия.\n    \"\"\"\n    # Случайные задержки между действиями\n    time.sleep(random.uniform(0.05, 0.2))\n\n    # Симуляция движения мыши по синусоидальной траектории\n    if random.random() > 0.3:\n        x_offset = random.randint(100, 300)\n        y_points = [int(100 + 50 * math.sin(i/10)) for i in range(50)]\n        for y in y_points:\n            page.mouse.move(x_offset, y)\n            time.sleep(0.01)\n\n\ndef spoof_webgl(page: Page):\n    \"\"\"\n    Эмулирует стандартные WebGL-рендерованные текстуры.\n    \"\"\"\n    page.evaluate('''()\n    => {\n        const getParameter = WebGLRenderingContext.prototype.getParameter;\n        WebGLRenderingContext.prototype.getParameter = function(parameter) {\n            if (parameter === 37445) return 'Google Inc.'; // renderer\n            if (parameter === 7936) return 'WebGL 2.0'; // version\n            return getParameter.apply(this, [parameter]);\n        };\n    }''')\n\nclass BrowserAutomation:\n    def __init__(self, page: Page):\n        self.page = page\n\n    def apply_stealth(self):\n        spoof_plugins(self.page)\n        spoof_webgl(self.page)\n        # Дополнительные методы скрытности могут быть добавлены здесь